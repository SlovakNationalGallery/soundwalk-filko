<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="initial-scale=1, width=device-width, user-scalable=no" />
  <title>SoundWalk Filko</title>

  <link rel="stylesheet" href="css/fonts.css" />
  <link rel="stylesheet"  href="css/themes/strazky/jquery.mobile.custom.structure.min.css">
  <link rel="stylesheet"  href="css/themes/strazky/jquery.mobile.custom.theme.min.css">
  <link rel="stylesheet" href="css/style.css" />

  <script src="cordova.js"></script>
  <script src="js/jquery.min.js"></script>
  <script src="js/jquery.mobile.custom.min.js"></script>

  <!-- jQuery.i18n -->
  <script src="js/jquery.i18n/jquery.i18n.js"></script>
  <script src="js/jquery.i18n/jquery.i18n.messagestore.js"></script>
  <script src="js/jquery.i18n/jquery.i18n.fallbacks.js"></script>
  <script src="js/jquery.i18n/jquery.i18n.parser.js"></script>
  <script src="js/jquery.i18n/jquery.i18n.emitter.js"></script>
  <script src="js/jquery.i18n/jquery.i18n.language.js"></script>

  <script src="js/utility.js"></script>
  <script src="js/player.js"></script>
  <script src="js/languageswitcher.js"></script>
  <script src="js/filkoshoutplayer.js"></script>

  <script type="text/javascript">

    $(document).ready(function() {
      document.addEventListener("deviceready", onDeviceReady, true);
      // onDeviceReady(); //only for debuging

      // LanguageSwitcher initialisation
      $('.ui-langswitch-en').click( function() {
        LanguageSwitcher.switchLanguage("body", "en");
        $('.ui-langswitch-sk').removeClass('ui-btn-active');
        createList("filko-en.json", "#track-list");
      } );
      $('.ui-langswitch-sk').click( function() {
        LanguageSwitcher.switchLanguage("body", "sk");
        $('.ui-langswitch-en').removeClass('ui-btn-active');
        createList("filko-sk.json", "#track-list");
      } );
      
      // add active ui class to button to keep state persistent after page transitions
      $( "body" ).on( "pagecontainerbeforetransition", function( event, ui ) {
        if (ui.toPage[0].id === "home-page") {
          switch ($.i18n().locale) {
            case "en":
              $(".ui-langswitch-en").addClass('ui-btn-active');
              break;
            case "sk":
              $(".ui-langswitch-sk").addClass('ui-btn-active');
              break;
            default:
              console.log("unknown locale "+language+" to set active button state");
          }
        }
      } );
    });

    var audioMedia = null,
    audioTimer = null,
    duration = -1,
    is_paused = false;

    function onDeviceReady() {
      FilkoShoutPlayer.initMediaFiles();
      $("#dia").click(function (event) {
        FilkoShoutPlayer.playNextFilkoShout();  
      });

      var langToSet = LanguageSwitcher.retrievePreferredLang();
      triggerLanguageUI(langToSet);

      if(navigator.userAgent.match(/iP[ha][od].*OS 7/)) { //if ios7
        $('.ui-btn-left, .ui-btn-right ').css('top','.48em');
      }

      $("#track-list-page").bind("pageinit", function(event) {
        $("#track-list a").removeClass("ui-btn-icon-left");
        $('.ui-nosvg .mapka .circle').removeClass("active");
      });
      
      $(document).on('click', '.player-play', function () { Player.playPause(); })
      $(document).on('slidestop', '.time-slider', function (event) { Player.seekPosition(event.target.value); })

      $(document).on('click', ".external", function (e) {
        e.preventDefault();
        var targetURL = $(this).attr("href");

        window.open(targetURL, "_system");
      });


      $(document).on('collapsibleexpand', '.ui-collapsible', function() {
        $(this).children().next().slideDown(200);
        $(".slider").slider('refresh');
        initPlayer($(this));
      })

      $(document).on('collapsiblecollapse', '.ui-collapsible', function() {
        $(this).children().next().slideUp(200);
      });

    };

    function createList(sourceFile, listId) {
      $(listId).empty();
      $.getJSON(sourceFile, function(data) {         
        $.each(data, function(index, zastavka){
          var listItem = '';
          listItem += '<div data-role="collapsible" class="track" rel="'+zastavka.audio+'" data-bgcolor="'+zastavka.bgcolor+'">' + 
          '<img class="track-bg" src="'+zastavka.bgimg+'" alt=""/>'+
          '<h3>'+zastavka.title+'<span class="index '+zastavka.indexcolor+'">'+(index)+'</span></h3>' +
          '<div class="center-wrapper negative-margin">'+
          '<a href="#" class="player-play no-text-shadow"><span class="icon-play"></span></a>'+
          '<div>'+
          '<label class="media-played">00:00</label><label class="media-duration">00:00</label><br />'+
          '<input type="range" class="time-slider" value="0" min="0" max="100" data-role="none" data-highlight="true" data-mini="true" />'+
          '</div>'+
          '</div>'+
          '</div>';
          $(listId).append(listItem);
        });

        $(listId + " .time-slider" ).slider();
        // $(listId + " .time-slider").trigger('create'); //pozor!
        $(listId).collapsibleset( "refresh" );

        $(listId).on('collapsibleexpand', function (event, ui) {
            // console.log('Expanded');
            var bgColor = $(event.target).attr('data-bgcolor');
            $(listId).parent().addClass('bg-'+bgColor);
        }).on('collapsiblecollapse', function (event, ui) {
            console.log('Collapsed');
            // console.log(event);
            console.log(event.target);
            var bgColor = $(event.target).attr('data-bgcolor');
            $(listId).parent().removeClass('bg-'+bgColor)
        });

        $("#track-list a").removeClass("ui-btn-icon-left");
      });
      $(listId).collapsibleset();
    };

    function initPlayer(thePlayer) {
      Player.stop();

      var root_path = "/";
      if (device.platform == "Android") {
        root_path = "/android_asset/www/";
      }
      var soundfile = root_path + 'sounds/' + $(thePlayer).attr('rel');
      Player.initMedia(soundfile);
    };

    function triggerLanguageUI(language) {
      switch (language) {
        case "en":
          $('.ui-langswitch-en').click();
          break;
        case "sk":
          $('.ui-langswitch-sk').click();
          break;
        default:
          console.log("unknown language "+language+" passed to triggerLanguageUI()");
      }
    };
  </script>
</head>
<body>
  <div id="home-page" data-role="page">
    <div class="logo ui-btn-right">
      <span class="icon-sng"></span>
    </div>

    <div class="languageSwitch ui-btn-left" data-role="controlgroup">
      <a class="ui-langswitch-sk" href="index.html">SK</a>
      <a class="ui-langswitch-en" href="index.html">EN</a>
    </div>

    <div class="center-wrapper intro-screen">
      <a href="#track-list-page" data-transition="slideup">
        <div class="rotated border-top-bottom">
          <h1 id="filko-title">FILKO</h1>
          <h2 id="app-description" data-i18n="filko-app-description">AUDIO GUIDE</h2>
        </div>  
      </a>
    </div> <!-- /center-wrapper -->
    <div class="footer">
        <a href="#credits-page" id="credits-link" class="circle-border ui-btn-left" data-transition="slide" data-direction="reverse">c</a>
        <a href="#info-page" id="info-link" class="ui-btn-right" data-transition="slide">Info</a>
      </div>
  </div>   <!-- /page -->

  <!-- PAGE TRACK LIST -->
  <div id="track-list-page" data-role="page">
    <header data-role="header" data-position="fixed" data-tap-toggle="false">
      <h1></h1> <!-- empty header to fill height of header -->
      <a href="#" data-icon="arrow-l"  data-rel="back" title="Go back" class="back ui-btn-left" data-transition="slidedown" data-i18n="filko-back">Späť</a>
      <div class="logo ui-btn-right"><span class="icon-sng"></span></div>
    </header>
    <div data-role="main" class="ui-content">
      <div data-role="collapsible-set"  data-inset="false" id="track-list"></div>
    </div>
  </div> <!-- /page -->

  <!-- PAGE INFO -->
  <div id="credits-page" data-role="page">
    <header data-role="header" data-position="fixed" data-tap-toggle="false">
      <a href="#home-page" data-icon="arrow-l" title="Go back" class="back ui-btn-left" data-transition="slide" data-i18n="filko-back">Späť</a>
      <div class="logo ui-btn-right"><span class="icon-sng"></span></div>
      <h1>&nbsp;</h1>
    </header>
    <div data-role="main">
      <div class="ui-content">
        <h2>Info</h2>
        <p>
         Soudwalk Strážky je aplikácia pre mobilné zariadenia, ktorá vás Kaštieľom Strážky prevedie prostredníctvom krátkych audio-príbehov. Ožijú v nich postavy významných obyvateľov kaštieľa  &mdash; „čudáckeho“ maliara Ladislava Mednyánszkeho, jeho príbuznej a poslednej pamätníčky starých čias, barónky Margity Czóbelovej. 
        </p>
        <p>V príbehoch sa realita prelína s fikciou: na prízemí kaštieľa sa pred vami pohádajú postavy z portrétnej galérie, v parku sa od sôch dozviete o zakázanej láske Medyánszkeho. Jeho peripetie na vojenskom fronte vám prerozprávajú stromy v parku a život barónky priblíži jej opatrovateľka, pani Mária Milistenferová zo Strážok.</p>
        <p>Zvuky sprevádzajúce príbehy boli zaznamenané v priestoroch kaštieľa a v jeho bezprostrednom okolí. Na niektorých zastávkach „ozvučujú“ obraz alebo pohľad z okna, v iných dotvárajú atmosféru prostredia. Sú rovnako dôležité ako postavy a ich príbehy, pre najlepší zážitok odporúčame zapožičať si v kaštieli kvalitné slúchadlá.  </p>
        <p>Zastávky sú rozdelené na dve časti. V parku sa nechajte viesť rozprávačmi príbehov a jednoduchou mapkou, v kaštieli vám pri orientácii pomôže lektor. Príbehy z parku sú dostupné pre všetkých, príbehy z kaštieľa len pre platiacich návštevníkov.</p>
      </div>
      <div class="ui-content green-panel">    
        <h2>O aplikácií</h2>
        <div class="center-wrapper">
          <p class="label">Koncepcia</p><p class="cast"> Katarína Fitková <br> Jonathan Prior</p>
          <p class="label">Produkcia</p><p class="cast"> Barbora Jurinová <br> Michal Čudrnák </p>
          <p class="label">Scenár</p><p class="cast"> Katarína Fitková</p>
          <p class="label">Nahrávky, zvukový dizajn</p><p class="cast"> Jonathan Prior <br><small>(<a href="http://12gatestothecity.com/" class="external">12gatestothecity.com</a>)</small></p>
          <p class="label">Vývoj aplikácie</p><p class="cast"> Igor Rjabinin </p>
          <p class="label">Grafický dizajn</p><p class="cast"> Braňo Matis </p>
          <p class="label">Odborná spolupráca</p><p class="cast"> Katarína Beňová<br /> Mária Šelepová</p>
          <p class="label">Herci</p>
          <p class="cast"> 
            Helena Čertíková<br />
            Miriam Kalinková<br />
            František Kovár<br />
            Dušan Szabó
          </p>
          <p class="label">Majster zvuku <br> (štúdiové nahrávky hercov)</p><p class="cast"> Ladislav Borš</p>
          <p class="label">Špeciálne poďakovanie</p><p class="cast"> Mária Milistenferová<br>
          <small>(opatrovateľka Margity Czóbelovej)</small></p>
          <p class="label">Video upútavka</p><p class="cast"> Anton Kajan </p>
          <p class="label">Video upútavka - hudba</p><p class="cast"> Josh Woodward - Already There<br/><small>(Creative Commons BY 3.0)</small></p>
          <p class="label">Zvukové nahrávky</p><p class="cast"> <a href="http://bit.ly/1aKcBJi" class="external">archive.org</a> <br/><small>(Creative Commons BY-NC-SA 3.0)</small></p>
          <p class="label">Zdrojový kód</p><p class="cast"><a href="http://lab.sng.sk/" class="external">lab_SNG</a></p>
          <p>V aplikácii boli použité archívne materiály z Národného filmového archívu Slovenského filmového ústavu v Bratislave <br>(Muž, ktorý luže - 1968, r. A.Robbe-Grillet)</p>
        </div>
      </div>
    </div>
  </div>


  <!-- PAGE CONTACT -->
  <div id="info-page" data-role="page">
    <header data-role="header" data-position="fixed" data-tap-toggle="false">
      <a href="#" data-icon="arrow-l"  data-rel="back" title="Go back" class="back ui-btn-left" data-transition="slide" data-direction="reverse"  data-i18n="filko-back">Späť</a>
      <div class="logo ui-btn-right"><span class="icon-sng"></span></div>
      <h1>&nbsp;</h1>
    </header>
    <div data-role="main">
      <div class="ui-content">
        <h2>Otváracie hodiny</h2>
        <div class="contact-item">
          <p>Denne 10.00 – 18.00</p> 
          <p>V zimnom období (16. 9. – 14. 6.)<br>
            Streda – nedeľa 10.00 – 17.00</p>
        </div>
        <h2>Kontakt</h2>
        <div class="contact-item">
          <span class="icon-contact contact-icon"></span>
          <div class="contact-content">
            SNG – Kaštieľ Strážky<br>
            Mednyánszkeho 25<br>
            059 01 Spišská Belá<br>
            <a href="http://maps.google.com/?q=Ka%C5%A1tiel+Str%C3%A1%C5%BEky,+Ladislava+Med%C5%88ansk%C3%A9ho,+Spi%C5%A1sk%C3%A1+Bel%C3%A1,+Slovensk%C3%A1+republika&amp;ll=49.172558,20.456028&amp;spn=0.016217,0.029311&amp;sll=37.06250000000001,-95.67706800000003&amp;sspn=50.415107642905134,102.22236270375726" class="external">zobraziť mapu <span class="icon-arrow-right"></span></a>
          </div>
        </div>
        <div class="contact-item">
          <span class="icon-phone contact-icon"></span>
          <div class="contact-content">
            00-421-52-45 81 312<br>
            <a href="tel:+421524581312">zavolať <span class="icon-arrow-right"></span></a>
          </div>
        </div>
        <div class="contact-item">
          <span class="icon-mail contact-icon"></span>
          <div class="contact-content">
            <a href="mailto:strazky@sng.sk">strazky@sng.sk</a>
          </div>
        </div>
        <div class="contact-item">
          <span class="contact-icon"></span>
          <div class="contact-content">
            <a href="http://www.sng.sk/sk/uvod/vysunute-pracoviska/strazky" class="external">www.sng.sk</a>
          </div>
        </div>
        <div class="contact-item">
          <span class="contact-icon"></span>
          <div class="contact-content">
            <a href="http://www.facebook.com/pages/SNG-Kaštieľ-Strážky/392651784106507" class="external">facebook</a>
          </div>
        </div>
      </div>
      <div class="ui-content green-panel">
        <h2>O kaštieli</h2>
        <p>Slovenská národná galéria získala objekt Kaštieľa Strážky do správy v roku 1972 prevodom po smrti bývalej majiteľky, barónky Margity Czóbelovej. V kaštieli sa realizovala rekonštrukcia aj revitalizácia anglického parku z 19. storočia, kde je v súčasnosti nainštalovaná expozícia plastiky. Vo výstavných priestoroch kaštieľa sú umiestnené stále expozície, konajú sa tu hudobno-dramatické a vzdelávacie programy. Stále expozície približujú najmä dielo Ladislava Mednyánszkeho, portrétnu tvorbu na Spiši, zbierky historickej knižnice a mobiliár zámku.</p>
      </div>
    </div>
  </div> <!-- /page -->
</body>
</html>
